<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: HomePage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: HomePage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module HomePage
 */
import React, { useState, useEffect } from 'react';
import TrashImage from './assets/trash.png';
import AddAreaImage from "./assets/add.png";
import LogoImage from "./assets/logo.png";
import LogoSpotify from "./assets/spotify.png"
import LogoIss from "./assets/iss.png"
import LogoStrava from './assets/strava.png';
import LogoTwitch from './assets/twitch.png';
import LogoTwitter from './assets/twitter.png';
import LogoGoogle from './assets/google.png';
import LogoMeteo from './assets/meteo.png';
import LogoNasa from './assets/nasa.png';
import SettingsImage from "./assets/avatar.png";
import { useNavigate } from "react-router-dom"
import { authWithCache } from './Common/Login'
import Popup from 'reactjs-popup';

/**
 * @brief Return the Home page for AREA
 * This page will be updated soon
 */
export default function HomePage(props) {
    const [asked, setAsked] = useState(false)
    const [location, setLocation] = useState({ latitude: props.userInformation.coord.latitude, longitude: props.userInformation.coord.longitude, city: props.userInformation.coord.city })
    const navigate = useNavigate();

    let logo = {
        "spotify": LogoSpotify,
        "iss": LogoIss,
        "nasa": LogoNasa,
        "twitter": LogoTwitter,
        "google": LogoGoogle,
        "météo": LogoMeteo,
        "twitch": LogoTwitch,
        "strava": LogoStrava
    }

    const addArea = () => {
        navigate('/addArea')
    }

    const goSettings = () => {
        navigate('/settings')
    }

    useEffect(() => {
        try {
            authWithCache(props.setUserInformation, props);
            console.log("Already logged in")
        } catch (error) {
            console.log("Unable to login" + error);
            navigate("/auth")
        }
    }, [])

    useEffect(() => {
        const fetchData = () => {
            console.log(props.userInformation.id)
            fetch(props.userInformation.ip + "/getAreas/" + props.userInformation.id)
                .then(response => {
                    response.json().then(data => {
                        let areaArray = []
                        for (const area in data.areas) {
                            let action = data.areas[area].Action
                            let reaction = data.areas[area].Reaction
                            let id = data.areas[area].id
                            areaArray.push({ action: action, reaction: reaction, id: id })
                        }
                        props.setAllAreas(areaArray)
                    })
                })
                .catch(error => {
                    console.error(error);
                })
        };
        fetchData();
        if (props.userInformation.locationAccept === false &amp;&amp; navigator.geolocation) {
            props.userInformation.locationAccept = true
        }
        if (props.userInformation.locationAccept) {
            navigator.geolocation.getCurrentPosition((position) => {
                props.setUserInformation({
                    mail: props.userInformation.mail,
                    locationAccept: props.userInformation.locationAccept,
                    coord: {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        city: props.userInformation.coord.city
                    },
                    id: props.userInformation.id,
                    services: {
                        spotifyId: props.userInformation.services.spotifyId,
                        googleId: props.userInformation.services.googleId,
                        twitterId: props.userInformation.services.twitterId,
                        twitchId: props.userInformation.services.twitchId,
                        stravaId: props.userInformation.services.stravaId
                    },
                    ip: props.userInformation.ip
                })
                setLocation({ latitude: position.coords.latitude, longitude: position.coords.longitude, city: props.userInformation.coord.city })
            })
        }
    }, [props.userInformation.id])

    useEffect(() => {
        if (asked === false) {
            fetch("https://api-adresse.data.gouv.fr/reverse/?lon=" + location.longitude + "&amp;lat=" + location.latitude)
                .then((res) => {
                    res.json()
                        .then((jsonRes) => {
                            if (jsonRes &amp;&amp; jsonRes.features &amp;&amp; jsonRes.features[0] &amp;&amp; jsonRes.features[0].properties) {
                                setLocation({ latitude: location.latitude, longitude: location.longitude, city: jsonRes.features[0].properties.city });
                            } else {
                                setLocation({ latitude: location.latitude, longitude: location.longitude, city: location.city });
                                console.log("Une erreur a été rencontrée en essayant de trouver votre ville à partir de votre localisation. Vos données ont tout de même été mises à jour.")
                            }
                        })
                }).catch((err) => {
                    console.warn("error while fetching city from location: ", err)
                })
            setAsked(true)
            props.setUserInformation({
                mail: props.userInformation.mail,
                locationAccept: props.userInformation.locationAccept,
                coord: {
                    latitude: location.latitude,
                    longitude: location.longitude,
                    city: location.city
                },
                id: props.userInformation.id,
                services: {
                    spotifyId: props.userInformation.services.spotifyId,
                    googleId: props.userInformation.services.googleId,
                    twitterId: props.userInformation.services.twitterId,
                    twitchId: props.userInformation.services.twitchId,
                    stravaId: props.userInformation.services.stravaId
                },
                ip: props.userInformation.ip
            })
        }

    }, [location])
    /**
    * @description Remove an area from the list of areas
    * @function removeAreaFromList
    * @param {*} index The index of the area to remove
    */
    function removeAreaFromList(index) {
        async function supressArea() {
            try {
                const requestOptions = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ uid: props.userInformation.id, id: props.allAreas[index].id })
                }

                await fetch(props.userInformation.ip + "/remove/area", requestOptions).then(response => {
                    if (response.status === 200) {
                        let copyAreas = [...props.allAreas]
                        copyAreas.splice(index, 1)
                        props.setAllAreas(copyAreas)
                    } else {
                        console.log("Error")
                    }
                })
            } catch (error) {
                console.log(error);
            }
        }
        supressArea()
    }

    /**
     * @description Display an area
     * @function DisplayArea
     * @param {*} props The props of the area
     * @returns The area to display
     */
    function DisplayArea(props) {
        const title = (props.area.title) ? props.area.title : "AREA " + props.index;
        const action = (props.area.action) ? props.area.action : "Action";
        const reaction = (props.area.reaction) ? props.area.reaction : "Reaction";
        const global = {
            position: "relative",
            backgroundColor: "lightgrey",
            padding: "10px",
            borderRadius: "10px",
            diplsay: "flex",
            flexDirection: "column",
            alignItems: "center",
            justifyContent: "center",
            textAlign: "center",
            opacity: "0.9",

            title: {
                fontSize: "20px",
                fontWeight: "bold",
            },
            action: {
                fontSize: "15px",
            },
            reaction: {
                fontSize: "15px",
            },
            trash: {
                position: "relative",
                width: "30px",
                height: "30px",
                cursor: "pointer",
                border: "1px solid black",
                borderRadius: "20%",
            }

        }
        return (
            &lt;div style={global}>
                &lt;div style={global.title}>{title}&lt;/div>
                &lt;div style={global.action}>{action.description}.&lt;/div>
                &lt;div style={global.reaction}>{reaction.description}.&lt;/div>
                &lt;img src={TrashImage} alt={"trash image"} style={global.trash} onClick={() => removeAreaFromList(props.index)} />
            &lt;/div>
        )
    }

    /**
     * @description Display the list of areas
     * @function DisplayAreas
     * @param {*} props The props of the list of areas
     * @returns The area block to display
     */
    function AreaBlock(props) {
        const title = (props.area.title) ? props.area.title : "AREA ";
        const actionLogo = (props.area.action.logo) ? props.area.action.logo : "https://www.flaticon.com/svg/static/icons/svg/25/25231.svg";
        const reactionLogo = (props.area.reaction.logo) ? props.area.reaction.logo : "https://www.flaticon.com/svg/static/icons/svg/25/25231.svg";
        const style = {
            areaBlock: {
                position: "relative",
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                backgroundColor: "lightgrey",
                width: "300px",
                height: "400px",
                borderRadius: "20px",
                margin: "10px",
                cursor: "pointer",

                title: {
                    position: "relative",
                    fontSize: "32px",
                    margin: "5px",
                },
                content: {
                    position: "relative",
                    display: "flex",
                    flexDirection: "column",
                    justifyContent: "space-around",
                    alignItems: "center",
                    backgroundColor: "#5281B7",
                    width: "100%",
                    height: "150%",
                    borderRadius: "20px",
                    paddingVertical: "10px",
                },
                trash: {
                    position: "relative",
                    width: "30px",
                    height: "30px",
                    cursor: "pointer",
                    border: "1px solid black",
                    borderRadius: "20%",
                }
            }
        }

        return (
            &lt;div style={style.areaBlock}>
                &lt;div style={{ display: "flex", justifyContent: "space-around", flexDirection: "row", width: "100%" }}>
                    &lt;img src={logo[props.area.action.serviceName]} alt={"Logo de l'action"} style={{ width: "30px", height: "30px", padding: "5px" }} />
                    &lt;p style={style.areaBlock.title}>{title}&lt;/p>
                    &lt;img src={logo[props.area.reaction.serviceName]} alt={"Logo de la réaction"} style={{ width: "30px", height: "30px", padding: "5px" }} />
                &lt;/div>
                &lt;div style={style.areaBlock.content}>
                    &lt;div style={{ padding: "5px", height: "50px" }}>
                        &lt;p style={{ textAlign: "center", paddingLeft: "10px", paddingRight: "10px", fontSize: 24 }}>{props.area.action.description}&lt;/p>
                    &lt;/div>
                    &lt;div style={{ padding: "5px", height: "50px" }}>
                        &lt;p style={{ textAlign: "center", paddingLeft: "10px", paddingRight: "10px", fontSize: 24 }}>{props.area.reaction.description}&lt;/p>
                    &lt;/div>
                    &lt;img src={TrashImage} alt={"trash image"} style={style.areaBlock.trash} onClick={() => removeAreaFromList(props.index)} />
                &lt;/div>
            &lt;/div>
        )
    }

    /**
     * @description Display the list of areas
     * @function DisplayAreas
     * @returns The list of areas to display
     */
    function DisplayAreas() {
        const style = {
            displayAreas: {
                position: "relative",
                display: "grid",
                gridAutoColumns: "3",
                gridTemplateColumns: "repeat(3, auto)",
                justifyContent: "space-around",
                alignItems: "safe center",
                width: "minmax(300px, 100%)",
                height: "100%",
                padding: "10px",
            },
            noArea: {
                position: "relative",
            }
        }

        if (props.allAreas.length !== 0) {
            return (
                &lt;div style={style.displayAreas}>{
                    props.allAreas.map((item, index) => {
                        return (
                            &lt;AreaBlock area={item} index={index} />
                        )
                    })
                }&lt;/div>
            )
        }
        return (
            &lt;div style={style.displayAreas}>
                &lt;h3 style={style.noArea}>Tu n'as pas encore créé d'AREA 🥺&lt;/h3>
            &lt;/div>
        )
    }

    /**
     * @description Display the header of the page
     * @function Header
     * @returns The header of the page
     */
    function Header() {
        const mail = props.userInformation.mail;
        const [buttonHoverState, setButtonHoverState] = useState(false);
        const style = {
            header: {
                position: "relative",
                display: "flex",
                flexDirection: "row",
                justifyContent: "flex-start",
                alignItems: "center",
                height: "50px",
                padding: "10px",

                logo: {
                    position: "relative",
                    width: "50px",
                    height: "50px",
                    cursor: "pointer",
                },
                title: {
                    position: "relative",
                    paddingLeft: "10px",
                },
                settings: {
                    position: "relative",
                    width: "50px",
                    height: "50px",
                    marginLeft: "auto",
                    borderRadius: "50%",
                    cursor: "pointer",
                },
                button: {
                    all: "unset",
                    position: "relative",
                    border: "1px solid black",
                    padding: "10px",
                    borderRadius: "10px",
                    cursor: "pointer",
                    backgroundColor: buttonHoverState ? "lightgrey" : "transparent",
                }
            },
        }

        function mouseEnterButton() {
            setButtonHoverState(true);
            console.log("mouse enter");
        }
        function mouseLeaveButton() {
            setButtonHoverState(false);
            console.log("mouse leave");
        }
        return (
            &lt;div style={{ position: "relative" }}>
                &lt;div style={style.header}>
                    &lt;img src={LogoImage} style={style.header.logo} alt="logo" />
                    &lt;h1 style={style.header.title}>Re-Bonjour, {(mail) ? mail : "MAIL UNDEFINED"} !&lt;/h1>
                    &lt;img src={SettingsImage} style={style.header.settings} onClick={goSettings} alt="settings" />
                &lt;/div>
                &lt;div style={{ position: "relative", display: "flex", alignItems: "center", justifyContent: "center" }}>
                    &lt;a style={style.header.button} onMouseEnter={mouseEnterButton} onMouseLeave={mouseLeaveButton} href='client.apk'>Télécharger client.apk&lt;/a>
                &lt;/div>
            &lt;/div>
        )
    }

    /**
     * @description Display the body of the page
     * @function Body
     * @returns The body of the page
     */
    function Body() {
        const style = {
            body: {
                position: "relative",
                display: "flex",
                flexDirection: "column",
                justifyContent: "flex-start",
                alignItems: "center",
                title: {
                    position: "relative",
                    fontSize: "32px",
                },
                addArea: {
                    position: "relative",
                    width: "50px",
                    height: "50px",
                    cursor: "pointer",
                },
            },
        }

        return (
            &lt;div style={style.body}>
                &lt;p style={style.body.title}>AREAS&lt;/p>
                &lt;img style={style.body.addArea} src={AddAreaImage} onClick={addArea} alt="addArea" />
                &lt;DisplayAreas />
            &lt;/div>
        )
    }
    const globalStyle = {
        position: "relative",
        fontFamily: "Avenir Next,Avenir Next W01, Avenir,helvetica,arial,sans-serif",
    }
    return (
        &lt;div id="global" style={globalStyle}>
            &lt;Header />
            &lt;Body />
        &lt;/div>
    )
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AddAreaPage.html">AddAreaPage</a></li><li><a href="module-App.html">App</a></li><li><a href="module-AuthPage.html">AuthPage</a></li><li><a href="module-CacheManagement.html">CacheManagement</a></li><li><a href="module-HomePage.html">HomePage</a></li><li><a href="module-index.html">index</a></li><li><a href="module-Loading.html">Loading</a></li><li><a href="module-Login.html">Login</a></li><li><a href="module-SettingsPage.html">SettingsPage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Mar 04 2023 18:11:10 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
